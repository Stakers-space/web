{{> header_dashboard}}
<main class="mx-auto max-w-[1600px] px-5 md:px-10">
	<section class="grid gap-6 mt-24 mb-24">
        <h1 class="text-2xl font-semibold">{{formTitle}}</h1>
        <ol class="list-decimal pl-6 space-y-2">
            {{#each newsList}}
            <li data-newsid="{{this.id}}" data-time="{{this.t}}" data-category="{{this.c}}" class="flex flex-wrap items-center gap-2">
                {{this.t}} [{{this.c}}] <a href="{{this.a}}" target="_blank" rel="nofollow noopener noreferrer">{{{this.m}}}</a> | 
                <button onclick="UpdateNews(this)" class="ml-2 inline-flex items-center rounded-lg border px-3 py-1 text-sm hover:bg-neutral-50 cursor-pointer">Edit</button></li>
            {{/each}}
        </ol>
         
        <h2 class="mt-10 text-xl font-semibold">Add / Update News</h2>
        <form method="post" action="{{submitLink}}" class="space-y-4">
            <div class="grid items-center gap-3 grid-cols-[max-content_1fr]">
                <label class="text-sm font-medium">Message ID (empty for adding new, filled for updating)</label>
                <input type="text" id="message_id" name="message_id" value="" class="w-64 rounded-lg border px-3 py-2 outline-none focus:ring-2 focus:ring-black/30">
            </div>
            <div class="space-y-2">
                <label for="message" class="text-sm font-medium">Message</label>
                <textarea type="text" id="message" name="message" rows="2" cols="100" required class="w-full rounded-lg border px-3 py-2 outline-none focus:ring-2 focus:ring-black/30"></textarea>
            </div>
            <div class="grid items-center gap-3 grid-cols-[max-content_1fr]">
                <label for="link" class="text-sm font-medium">Link</label>
                <input type="text" id="link" name="link" value="" required class="w-full rounded-lg border px-3 py-2 outline-none focus:ring-2 focus:ring-black/30">
            </div>
            <div class="flex flex-wrap items-center gap-x-6 gap-y-2">
                <span class="text-sm font-medium">Category</span>
                <label><input {{#if server.ethereum}}checked{{/if}} type="checkbox" name="ethereum" value="eth" id="ethChain"> Ethereum</label>
                <label><input {{#if server.gnosis}}checked{{/if}} type="checkbox" name="gnosis" value="gno" id="gnoChain"> Gnosis</label>
                <label><input {{#if server.fundamental}}checked{{/if}} type="checkbox" name="fundamental" value="fundamental" id="fundamental_new"> Fundamental</label>
                <label><input {{#if server.client}}checked{{/if}} type="checkbox" name="client" value="client" id="client_new"> Client</label>
            </div>
            <div class="grid items-center gap-3 grid-cols-[max-content_1fr]">
                <label for="timestamp" class="text-sm font-medium">Time</label>
                <input type="text" id="timestamp" name="timestamp" value="{{timestamp}}" class="w-64 rounded-lg border px-3 py-2 outline-none focus:ring-2 focus:ring-black/30">
            </div>

            {{#if failureCallback}}
                <p class="login-error text-red-600">{{{failureCallback}}}</p>
            {{/if}}
            <div class="pt-2">
                <input type="submit" class="submit inline-flex items-center rounded-lg bg-black px-5 py-2 text-white hover:opacity-90 cursor-pointer" id="submit" value="Submit">
            </div>
        </form>
    <script>
        function toggleSelect(selectId) { document.getElementById(selectId).classList.toggle("hide"); }

        function UpdateNews(e){
            const liElm = e.parentElement;
            document.getElementById("message_id").value = liElm.dataset.newsid;
            document.getElementById("message").value = liElm.children[0].innerHTML;
            document.getElementById("link").value = liElm.children[0].href;
            document.getElementById("ethChain").checked = (liElm.dataset.category !== null && liElm.dataset.category.indexOf("eth") !== -1);
            document.getElementById("gnoChain").checked = (liElm.dataset.category !== null && liElm.dataset.category.indexOf("gno") !== -1);
            document.getElementById("fundamental_new").checked = (liElm.dataset.category !== null && liElm.dataset.category.indexOf("fundamental") !== -1);
            document.getElementById("client_new").checked = (liElm.dataset.category !== null && liElm.dataset.category.indexOf("client") !== -1);
            // convert timestamp
            console.log(liElm.dataset.time);
            if(typeof liElm.dataset.time === 'number'){
                document.getElementById("timestamp").value = liElm.dataset.time;
            } else {
                document.getElementById("timestamp").value = toTimestamp(liElm.dataset.time);
            }
            
            function toTimestamp(dateString) {
                const date = new Date(dateString);
                return Math.floor(date.getTime());
            }
        }
    </script>

    </section>
</main>
{{> scripts/security-guard}}
{{> footer_tailwind}}