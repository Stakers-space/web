{{> header}}
<main class="mx-auto max-w-[1600px] px-5 md:px-10">
	<section class="mt-8">
        <ul class="broadcrumbs" vocab="https://schema.org/" typeof="BreadcrumbList">
			<li property="itemListElement" typeof="ListItem">
					<a property="item" typeof="Thing" href="/"><span property="name">Stakers.space</span></a>
					<meta property="position" content="1">
				</li>
				<li property="itemListElement" typeof="ListItem">
					<a property="item" typeof="Thing" href="/{{chainUrl}}"><span property="name">{{chainName}} staking</span></a>
					<meta property="position" content="2">
				</li>
                <li property="itemListElement" typeof="ListItem">
					<a property="item" typeof="Thing" href="/{{chainUrl}}/validators"><span property="name">Validators</span></a>
					<meta property="position" content="3">
				</li>
			</ul>
		<h1 class="text-2xl font-semibold mt-4">{{chainName}} Validators Overview</h1>
        <div class="space-y-0">
            <div class="h-60 md:h-80 lg:h-140">
                <canvas id="validators_overview" class="w-full h-full chart_canvas" name="lazy-canvas"></canvas>
            </div>
            <div class="h-36 md:h-44 lg:h-52">
                <canvas id="validators_overview_diff" class="w-full h-full chart_canvas" name="lazy-canvas"></canvas>
            </div>
        </div>
	</section>

     <section class="mt-10">
		<h2 class="text-2xl font-semibold">{{chainName}} Validator Queue</h2>
        <p class="text-neutral-900 mt-5">Enterance and exit queues are validators waiting to begin staking or to unstake.</p>
        <p class="text-neutral-600">Last Update: {{formatDate queue.current.updatedOn}}</p>
	</section>

    <section class="mt-6">
        <div class="grid gap-6 md:grid-cols-3 items-stretch">
            <div id="entry-queue" class="rounded-2xl border bg-neutral-50 p-5 flex flex-col min-h-[360px]">
                <h3 class="text-lg font-semibold">Entry Queue</h3>
                <table class="mt-3 min-w-full text-sm">
                    <tbody class="divide-y">
                        <tr>
                            <td class="px-3 py-2 text-neutral-600">Validators:</td>
                            <td class="px-3 py-2 text-right font-medium">{{formatNumber queue.current.help.entryQueue.validators '0,0'}}</td>
                        </tr>
                        <tr>
                            <td class="px-3 py-2 text-neutral-600">Wait:</td>
                            <td class="px-3 py-2 text-right">{{queue.current.activation.waitingTimeHours}} hours, {{queue.current.activation.waitingTimeMinutes}} minutes</td>  
                        </tr>
                        <tr>
                            <td class="px-3 py-2 text-neutral-600">Churn:</td>
                            <td class="px-3 py-2 text-right">{{queue.current.activation.rate_per_epoch}} / epoch</td>
                        </tr>
                    </tbody>
                </table>
                <canvas id="entry_queue_chart" name="lazy-canvas"></canvas>
            </div>
            <div id="exit-queue" class="rounded-2xl border bg-neutral-50 p-5 flex flex-col min-h-[360px]">
                <h3 class="text-lg font-semibold">Exit Queue</h3>
                <table class="mt-3 min-w-full text-sm">
                    <tbody class="divide-y">
                        <tr>
                            <td class="px-3 py-2 text-neutral-600">Validators:</td>
                            <td class="px-3 py-2 text-right font-medium">{{formatNumber queue.current.stateCount.active_exiting.validators '0,0'}}</td>
                        </tr>
                        <tr>
                            <td class="px-3 py-2 text-neutral-600">Wait:</td>
                            <td class="px-3 py-2 text-right font-medium">{{queue.current.exiting.waitingTimeHours}} hours, {{queue.current.exiting.waitingTimeMinutes}} minutes</td>  
                        </tr>
                        <tr>
                            <td class="px-3 py-2 text-neutral-600">Churn:</td>
                            <td class="px-3 py-2 text-right font-medium">{{queue.current.exiting.rate_per_epoch}} / epoch</td>  
                        </tr>
                    </tbody>
                    
                </table>
                <canvas id="exit_queue_chart" name="lazy-canvas"></canvas>
            </div>
            <div id="churn-rate" class="rounded-2xl border bg-neutral-50 p-5 flex flex-col min-h-[360px]">
                <h3 class="text-lg font-semibold">Churn Schedule</h3>
                <p class="mt-1 text-sm text-neutral-700">The churn is a rate limit on the amount of validators that can enter or exit per epoch and changes based on the amount of active validators. This throttling mechanism help prevent instability in consensus.</p>
                <div class="mt-3 h-65 overflow-y-auto">
                    <table class="min-w-full text-sm border rounded-lg overflow-hidden">
                        <thead class="bg-neutral-100 text-neutral-700">
                            <tr>
                                <th class="px-3 py-2 text-left font-semibold">Active Validators</th>
                                <th class="px-3 py-2 text-left font-semibold">Churn Per Epoch</th>
                                <th class="px-3 py-2 text-left font-semibold">Churn Per Day</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{#each queue.schedule}}
                            <tr class="odd:bg-white even:bg-neutral-50 {{#ifEqual @index ../queue.rangeIndex}}!bg-neutral-300 font-semibold{{/ifEqual}}">
                                <td class="px-3 py-2 text-left">{{this.min_hr}}</td>
                                <td class="px-3 py-2 text-left">{{this.churnEpoch}}</td>
                                <td class="px-3 py-2 text-left">{{this.churnDay}}</td>
                            </tr>
                        {{/each}}
                        </tbody>
                    </table>
                 </div>
            </div>
        </div>
    </section>
    <section class="mt-15 my-10">
        <h2 class="text-2xl font-semibold">{{chainName}} BeaconChain Snapshot</h2>
        <p class="text-neutral-600">Last Update: {{formatDate valcount.timeMs}}</p>
        <div class="mt-4 grid gap-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4">
            {{#each valcount.stateCount}}
            <article class="rounded-2xl border bg-neutral-50 p-5">
                <header class="mb-3 flex items-center justify-between">
                <h3 class="text-sm font-medium text-neutral-700">
                    {{stateLabel @key}}
                </h3>
                <span class="inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium {{statePill @key}}">
                    {{@key}}
                </span>
                </header>

                <dl class="grid gap-3">
                <div class="flex items-baseline justify-between">
                    <dt class="text-sm text-neutral-600">Validators</dt>
                    <dd class="text-lg font-semibold">
                    {{formatNumber this.validators '0,0'}}
                    </dd>
                </div>

                <div class="flex items-baseline justify-between">
                    <dt class="text-sm text-neutral-600">Balance</dt>
                    <dd class="text-lg font-semibold">
                    {{formatNumber this.balance '0,0'}}
                    <span class="ml-1 text-xs font-normal text-neutral-500">{{{../chainTokenUpr}}}</span>
                    </dd>
                </div>

                <div class="flex items-baseline justify-between">
                    <dt class="text-sm text-neutral-600">Wallets</dt>
                    <dd class="text-lg font-semibold">
                    {{formatNumber this.wallets '0,0'}}
                    </dd>
                </div>
                </dl>
            </article>
            {{/each}}
        </div>


        <h2 class="text-2xl font-semibold my-10">{{chainName}} Wallets Snapshot</h2>
        {{#each walletsSnapshot}}
            <div class="my-5 rounded-2xl border bg-neutral-50 p-5">
                {{#with this}}
                <h3 class="text-xl font-semibold">Wallets in state: <code class="font-mono">{{stateLabel key}}</code> Â· Epoch <code class="font-mono">{{formatNumber epoch '0,0'}}</code> </h3>
                <div class="mt-3 grid gap-8 md:grid-cols-[3fr_2fr] items-stretch">
                    <div class="flex flex-col">
                        <h4 class="relative pl-3 text-sm font-semibold text-neutral-800">
                            <span class="absolute inset-y-0 left-0 w-1 rounded bg-neutral-300"></span>
                            Balance distribution across withdrawal wallets
                        </h4>
                        <canvas id="{{key}}_distribution" name="lazy-canvas" class="distribution-wealth-chart" data-state="{{key}}" data-token="{{../chainTokenUpr}}"></canvas>
                    </div>
                    <div class="flex flex-col">
                        <h4 class="relative pl-3 text-sm font-semibold text-neutral-800">
                            <span class="absolute inset-y-0 left-0 w-1 rounded bg-neutral-300"></span>
                            Top wallets
                        </h4>
                        <table class="text-sm">
                            <thead>
                                <tr>
                                    <th class="px-3 py-2 text-right w-10">#</th>
                                    <th class="font-mono break-all text-left">Wallet</th>
                                    <th class="text-right">Validators</th>
                                    <th class="text-right">{{{../chainTokenUpr}}} Balance</th>
                                    {{#ifEqual ../chain "gnosis"}}
                                    <th class="text-right">Unclaimed {{{../chainTokenUpr}}}</th>
                                    {{/ifEqual}}
                                </tr>
                            </thead>
                            <tbody>
                                {{#each topWlts}}
                                <tr>
                                    <td class="px-3 py-2 text-right tabular-nums">{{plus1 @index}}</td>
                                    <td class="font-mono break-all text-left"><a href="{{../../explorer}}/address/{{address}}" target="_blank" rel="noopener nofollow" class="underline">{{shortAddress address start=8 end=8}}</a></td>
                                    <td class="text-right">{{formatNumber validatorsCount '0,0'}}</td>
                                    <td class="text-right">{{formatNumber balance '0,0.0'}}</td>
                                    {{#ifEqual ../../chain "gnosis"}}
                                    <td class="text-right">{{formatNumber unclaimed '0,0.0'}}</td>
                                    {{/ifEqual}}
                                </tr>
                                {{/each}}
                            </tbody>
                        </table>
                    </div>
                </div>
                {{/with}}
            </div>
        {{/each}}
    </section>
    
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-annotation/2.1.0/chartjs-plugin-annotation.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom"></script>

<script>var chartConfig = {{{json charts}}};</script>
<script>var ethStoreData = {{{ethStoreData}}}, beaconchainData = {{{beaconData}}}, etherchainData = {{{chainData}}}, dashboardData={{{dashboardData}}}, chartsUIconfig = {{{chartsUIconfig}}}, queue = {{{queueChart}}}, valcount_history={{{valcount_history}}}, walletsSnapshotDist={{{walletsSnapshotDist}}};</script>
<script type="text/javascript" src="/js/chart-presenter.js"></script>
<script type="text/javascript" src="/js/charts/{{jsController}}.js"></script>
<script type="text/javascript" src="/js/charts/queue.js"></script>
<script type="text/javascript" src="/js/charts/wallets-wealth-distribution.js"></script>
<script type="text/javascript" src="/js/charts/sc-chart.js"></script>
<script>charts.ActivateLazyLoad();</script>
</main>
{{> footer_tailwind}}
{{> scripts/tabselector}}